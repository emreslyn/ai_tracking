{% extends "public/templates/public_template.html" %}

{% block title %}Results{% endblock %}

{% block main %}

<div class="container">
  <div class="row">
    <div class="col">

      <h1>Upload a file</h1>
      <hr>
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <ul class="navbar-nav">
            <li class="nav-item"><a class="nav-link" href="/">Home Page</a></li>
            <li class="nav-item"><a class="nav-link" href="/upload-file">Upload File</a></li>
            <li class="nav-item"><a class="nav-link" href="/monitor-results">Monitor Results</a></li>
        </ul>
      </nav>
      <table class="table">
        <thead>
            <tr>
                <th>Script</th>
                <th>Server</th>
                <th>Condition</th>
                <th>Action</th>
            <tr>
        </thead>
        <tbody>
            {% for key, file in files.items() %}
            <tr>
                <td>{{ file.file_name }}</td>
                <td>
                    <select name= colours method="GET" action="/">
                        {% for server in servers %}
                            <option value= "{{server}}" SELECTED>{{ server }}</option>"
                        {% endfor %}
                    </select>
                </td>
                <td>{{ file.condition }}</td>
                <td>
                    <div class="row">
                        <div class="col-md-3">
                            <form action="/run/{{ file.file_name }}">
                                <button type="submit" class="btn btn-primary">Run</button>
                            </form>
                        </div>
                        <div class="col-md-3">
                            <!--<form> <!--action="/monitor/{{ file.file_name }}"
                                <button type="submit" class="btn btn-secondary" data-toggle="modal" data-target="#SysInfo">Monitor</button>
                            </form>-->
                            <button type="submit" class=" open-AddBookDialog btn btn-secondary" data-toggle="modal" data-target="#SysInfo" data-filename="{{ file.file_name }}" data-server="{{ file.server }}" data-condition="{{ file.condition }}">Monitor</button>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="modal fade" id="SysInfo" tabindex="-1" role="dialog" aria-labelledby="SysInfoLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="SysInfoLabel">System Info</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" name="body" id="body" value=""/>
            Body
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>
</div>
<script>
    $('#SysInfo').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget) // Button that triggered the modal
      var msg1 = button.data('filename') // Extract info from data-* attributes
      var msg2 = button.data('server')
      var msg3 = button.data('condition')
      // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
      // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
      var modal = $(this)
      modal.find('.modal-body').text(msg1 + " --- " + msg2 + " --- " + msg3)
    });

    $(document).on("click", ".open-AddBookDialog", function () {
     var filename = $(this).data('filename');
     $(".modal-body #body").val( filename );
     // As pointed out in comments,
     // it is unnecessary to have to manually call the modal.
     // $('#addBookDialog').modal('show');
    });
</script>
{% endblock %}